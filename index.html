<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatyczny Skaner QR</title>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
    <style>
        #login-form, #send-section {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        #qr-reader {
            width: 300px;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <h1>Automatyczny Skaner QR</h1>
    <div id="qr-reader"></div>
    <div id="login-form">
        <h2>Logowanie</h2>
        <label>Username: <input type="text" id="username" readonly></label><br><br>
        <label>Password: <input type="text" id="password" readonly></label>
    </div>
    <div id="send-section">
        <h2>Akcja Zakończona</h2>
        <button onclick="alert('Dane zostały wysłane!')">SEND</button>
    </div>

    <script>
        let scannerStage = 1;  // Śledzenie etapu skanowania

        function startQRScanner() {
            const html5QrCode = new Html5Qrcode("qr-reader");

            html5QrCode.start(
                { facingMode: "environment" }, 
                { fps: 10, qrbox: { width: 250, height: 250 } },
                qrCodeMessage => {
                    if (scannerStage === 1) {
                        // Pierwsze skanowanie: przejście do logowania
                        console.log("Pierwszy kod QR zeskanowany: " + qrCodeMessage);
                        html5QrCode.stop();
                        startLoginProcess();
                    } else if (scannerStage === 2) {
                        // Drugie skanowanie: automatyczne wypełnienie danych logowania
                        console.log("Drugi kod QR zeskanowany: " + qrCodeMessage);
                        const [username, password] = qrCodeMessage.split(",");
                        document.getElementById("username").value = username || "Nieznany";
                        document.getElementById("password").value = password || "Nieznany";
                        html5QrCode.stop();
                        setTimeout(showSendButton, 10000);  // Symulacja weryfikacji danych
                    }
                },
                errorMessage => {
                    console.log("Błąd skanowania: " + errorMessage);
                }
            ).catch(err => {
                console.error("Błąd przy uruchamianiu skanera:", err);
            });
        }

        function startLoginProcess() {
            scannerStage = 2;
            document.getElementById("qr-reader").style.display = "block";
            document.getElementById("login-form").style.display = "block";
            startQRScanner();
        }

        function showSendButton() {
            document.getElementById("login-form").style.display = "none";
            document.getElementById("send-section").style.display = "block";
        }

        // Uruchomienie skanera przy wczytaniu strony
        window.addEventListener("load", startQRScanner);
    </script>
</body>
</html>

